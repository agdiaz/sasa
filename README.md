# Sequence Alignment using Simulated Annealing algorithm
Project created by Adrián Díaz and Roxana Cerretini

![Node.js CI](https://github.com/agdiaz/sasa/workflows/Node.js%20CI/badge.svg?branch=master)

## Overview
This program implements a Simulated Annealing algorithm to find the consensus aligment from many sequences. The main idea is to simulate the cooling of a material system: the colder the system is, the less energy is. There are three key concepts involved in the running of this program.

- How to build the system (initial state)
- How to measure the energy of the system (state's energy)
- How to find next state (next state)

### Initial state
It's a sequence created position by position with the length of the longest input sequence.

For example, given the next sequences:

```
POS 012345
SE1 ABCDEF
SE2 CDE
```

Positions were randomly generated like:

- POS 0: 'A' or 'C'
- POS 1: 'B' or 'D'
- POS 2: 'C' or 'E'
- POS 3: 'D' or '-'
- POS 4: 'E' or '-'
- POS 5: 'F' or '-'

Thus, the sequence "ABE-E-" could be a possible first sequence.

### Energy
There is a relation between the quality of the alignment and the energy of the system. Better aligments have low energy. This program determines energy of a state looking for mismatches between the current consensus sequence and the input ones.
Position by position, the energy function count the proportion of mismatches following the formula:

```
Energy(POS) = count(mismatches(POS) / count(input_sequences)
```

For instance, in this example, there are 8 positions to calculate energy
```
POS: 012345678
ALG: A-CDEF
SE1: ABCDYFGHI
SE2: ABDXZF
```

```
Energy(0): 0         = 0
Energy(1): 0.5 + 0.5 = 1
Energy(2): 0.5       = 0.5
Energy(3): 0.5       = 0.5
Energy(4): 0.5 + 0.5 = 1
Energy(5): 0         = 0
Energy(6): 0.5 + 0.5 = 1
Energy(7): 0.5 + 0.5 = 1
Energy(8): 0.5 + 0.5 = 1
```

Summatory of energy of all positions gives the energy of the current state (for the above's example is 6).
Thus, if the consensus sequence full match with all the input sequeces, the energy will be zero (the desired one).

### Next state
For every iteration, a dice of 12 sides is randomly thrown and depending the results, an operation which alters the state is executed. The proportion is the next distribution:

- 2/12: remove a element
- 3/12: change an element
- 2/12: add an element
- 1/12: add a delete
- 4/12: do nothing (keep the sequence as is)

Once the operation is choosen, it alters one random position of the current state.

## Preview
<img width="391" alt="Screen Shot 2020-02-03 at 10 48 50" src="https://user-images.githubusercontent.com/1646576/73658399-035f9300-4673-11ea-8625-46767659335b.png">

## Configuration

### Pre-requisites

Please, before to install this program, be sure that you have installed in your computer:
- nodejs

### Installing
Run the following command

`npm install`

## Arguments
```
Welcome to SASA!
Usage: index [options]

Options:
  -V, --version             output the version number
  -i, --input <file>        path to input file (default: [])
  -d, --debug [flag]        Output extra debugging (default: false)
  -t, --temperature [temp]  Initial temperature of the model (default: 1000)
  -l, --limit [number]      Max number of iterations (default: 500000)
  -h, --help                output usage information
```

## Examples
This repository contains some example files to run the program. The main argument is `--input <path>` to refer files:

`node index.js --input ./examples/example_01.fa --input ./examples/example_02.fa`

To view a dummy example execute:

```
node index.js --input ./examples/example_00_a.fa --input ./examples/example_00_b.fa --input ./examples/example_00_c.fa
```

### Real example

To reproduce this example execute:

```
node index.js --input ./examples/real/human_insulin.fa --input ./examples/real/bos_taurus_insulin.fa -e 30
```

#### Output

```
BEST SEQUENCE
INITIAL ENERGY 1132.50000
FINAL ENERGY   942.00000
FROM-TO: 0 49
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE TGCGTTCCTGGAGAATCCG-G-GAAACGGTGCCATCAGGGGCTGCGGCTC
SEQ01 AGCCCTCCAGGACAGGCTGCATCAGAAGAGGCCATCAAGCAGGTCTGTTC
SEQ02 TCAGTCCCTCAGTGTCCCCTGGGAAGCCGGGGACACTGTGGCTGGGGTGG

FROM-TO: 50 99
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE CAGCGCCAGGCTGCGGAGGTGGGCTCCGGG-TC---GCTTGCAGGACACC
SEQ01 CAAGGGCCTTTGCGTCAGGTGGGCTCAGGATTCCAGGGTGGCTGGACCCC
SEQ02 GTGCACGGGGCTGGGACAGTGGCCAAGGAGACACACGCCTGCTGCCCACC

FROM-TO: 100 149
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE GAGCGCCCGGTTTTCACGCAGGCCGGTGAGGCGTCCCCGG-GAAACAACA
SEQ01 AGGCCCCAGCTCTGCAGCAGGGAGGACGTGGCTGGGCTCGTGAAGCATGT
SEQ02 CCACGGCCTGGACCATCACCGGGGCTCGGGGGCAGCCCAGGGACACAGCA

FROM-TO: 150 199
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE GGGGCC-CGGCCTCGCACCCCCGC-TGAAGGTACGGGCCCTAGGGCTTCT
SEQ01 GGGGGTGAGCCCAGGGGCCCCAAGGCAGGGCACCTGGCCTTCAGCCTGCC
SEQ02 GGGGTCCCCCTTTCGCACCACTGCCTGGACTAACGTGGACGATGGGCCCA

FROM-TO: 200 249
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE GGAGCCGTGCCTG-CCGGAA-TCAACCCTCCTAGTTCGAGGGGACT-GTT
SEQ01 TCAGCCCTGCCTGTCTCCCAGATCACTGTCCTTCTGCCATGGCCCTGTGG
SEQ02 GGCAGGGCCAGGCGGAGGACTTCACCCCCAGCGGTGCGAGGGAACAGCTT

FROM-TO: 250 299
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE GTCGGGCACGGGCACCCGCAGGCGGTGCCTGCCCAACCGGAAGCTGACCG
SEQ01 ATGCGCCTCCTGCCCCTGCTGGCGCTGCTGGCCCTCTGGGGACCTGACCC
SEQ02 GGCGTGGATCGGGTCCCTCATTAAGACTCTAATGACCCCACGGCCCCAAG

FROM-TO: 300 349
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE ACCGCGCGCAACCCTAGGAGAAGCTCC-TCAGCCGCTGATGTAGGGGAAA
SEQ01 AGCCGCAGCCTTTGTGAACCAACACCTGTGCGGCTCACACCTGGTGGAAG
SEQ02 AGGTGCTGACGGCCAAGGAGAGGTTCCCGCAGCCCCGGCAGCAGGGAAAT

FROM-TO: 350 399
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE CAGACGCAATC-CCAGCCACAGACGCCGTGTCTTCTCCAGA-CTCAGGGC
SEQ01 CTCTCTACCTAGTGTGCGGGGAACGAGGCTTCTTCTACACACCCAAGACC
SEQ02 GATCCGGAAACTGCAGCCTCAGCCCCCGGGCCATCTGCCGCGCTCCTGGA

FROM-TO: 400 449
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE GGGCCTGAAGATGGGGA-CTTGCTG-GACCATGG-CTACTAGTCCGGAAG
SEQ01 CGCCGGGAGGCAGAGGACCTGCAGGGTGAGCCAACTGCCCATTGCTGCCC
SEQ02 GGCCCTGATGACGGGCCAGGTGGTGGGCTCAGGGGCTATAAAGCCGGCAG

FROM-TO: 450 499
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE AGCTCCTCAC-C-CCCTCCCCTTGCTCCGG-CGCCCCCTACGCTCCTAGA
SEQ01 CTGGCCGCCCCCAGCCACCCCCTGCTCCTGGCGCTCCCACCCAGCATGGG
SEQ02 GCCGCAGCAGCCCCCCGCCCTCAGGACCGGCTGCATTCGAGGCTGCCAGC

FROM-TO: 500 549
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE AAGAAATGGGCCCCGGGG-CCCAGCATGCAT-GGGGGGGGATTTCTCT-T
SEQ01 CAGAAGGGGGCAGGAGGCTGCCACCCAGCAGGGGGTCAGGTGCACTTTTT
SEQ02 AAGCAGGTCCGTCCGTGGGCTCTGCATCCGCCTGGGTCCGGGGCTGCCCC

FROM-TO: 550 599
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE -CTCTGGGGCTTCCTGTCGGCGCGTAAGCTGACTCA-GCACAGCG-CCGG
SEQ01 TAAAAAGAAGTTCTCTTGGTCACGTCCTAAAAGTGACCAGCTCCCTGTGG
SEQ02 GCTGGGGCTCAGGGTGTCGGGGCCCAGGTCCACTGAGCGGCAGGGGGATG

FROM-TO: 600 649
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE CGCGCTTACC-GGGCCACCCG-GGCCGGGCACG-GCCTGGGGGTTTAG-G
SEQ01 CCCAGTCAGAATCTCAGCCTGAGGACGGTGTTGGCTTCGGCAGCCCCGAG
SEQ02 TGCGCTCTCTCGGAGCACCCGGGGCGGGGGCCCTGGCTGAGGGTCCTGGG

FROM-TO: 650 699
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE ATGTGCCACATGGGTGGCACAGGGGTCTCGCGT-TCCCCTCTCAGGCG-A
SEQ01 ATACATCAGAGGGTGGGCACGCTCCTCCCTCCACTCGCCCCTCAAACAAA
SEQ02 TTGGGGGCCCTGGTTGAAGGTGCTGGGCTGGGGGCCCTGGCTGAGGGGCT

FROM-TO: 700 749
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE GGTCCGCGAGGTGATTTGACCAC-GTAGTGTG-TCTCCCCTC-CTTGACC
SEQ01 TGCCCCGCAGCCCATTTCTCCACCCTCATTTGATGACCGCAGATTCAAGT
SEQ02 GGGCTGGGGGACGGCCCTGACTGAGGGTCCTGGGCACCCCTCCCCTGGCT

FROM-TO: 750 799
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE CGTGGCACATTGGAGGCCGCTAGTGACC-CCCGTCTAAGGGGCGGCCGAT
SEQ01 GTTTTGTTAAGTAAAGTCCTGGGTGACCTGGGGTCACAGGGTGCCCCACG
SEQ02 CAGCCCCCGCTGTCGCCAGGTCCTCGCAGCCCCGCCATGGCCCTGTGGAC

FROM-TO: 800 849
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE ACGCATAGCGC-TGGGCTAGCCCCCACTAGCCCCTGGGGCGCGGATG-GC
SEQ01 CTGCCTGCCTCTGGGCGAACACCCCATCACGCCCGGAGGAGGGCGTGGCT
SEQ02 ACGCCTGGCGCCCCTGCTGGCCCTGCTGGCGCTCTGGGCCCCCGCCCCGG

FROM-TO: 850 899
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE TCCTGCTTGTCTGGGAGAGG-A-GC-GCTTGGCGCCTCCCTGCGTCGCCG
SEQ01 GCCTGCCTGAGTGGGCCAGACCCCTGTCGCCAGGCCTCACGGCAGCTCCA
SEQ02 CCCGCGCCTTCGTCAACCAGCATCTGTGTGGCTCCCACCTGGTGGAGGCG

FROM-TO: 900 949
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE CAGCCAGGAATAGAGGAAGAGCG-A-GTGTAGGGCC-GGAAAGATGCA-G
SEQ01 TAGTCAGGAGATGGGGAAGATGCTGGGGACAGGCCCTGGGGAGAAGTACT
SEQ02 CTGTACCTGGTGTGCGGAGAGCGCGGCTTCTTCTACACGCCCAAGGCCCG

FROM-TO: 950 999
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE GCGGTCAGCGGGGGACGCGCCCGG-GTGCA-CCT-TGACGCCGCTGCCCC
SEQ01 GGGATCACCTGTTCAGGCTCCCACTGTGACGCTGCCCCGGGGCGGGGGAA
SEQ02 CCGGGAGGTGGAGGGCCCCCAGGGTGAGCCCCCGCTGCCCCCGCTCCCCC

FROM-TO: 1000 1049
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE GC--TCCCCGGAGATACCCCTCCGGGCGTCCGCTGTCACCCCCCGTGCAA
SEQ01 GGAGGTGGGACATGTGGGCGTTGGGGCCTGTAGGTCCACACCCAGTGTGG
SEQ02 CCGGTCCCCCTGGCTCCCACCCTGGCCTCCCGCTGGCGCCTGGCAGAAAA

FROM-TO: 1050 1099
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE CCTGGGCTGCTAATAAACTATG-CAAGTCTGCCCGCGGA-CGTCAGGCTG
SEQ01 GTGACCCTCCCTCTAACCTGGGTCCAGCCCGGCTGGAGATGGGTGGGAGT
SEQ02 TCAGGAGAGATTTTTAAAAAGGAAAACCATGTCCTGTTGTTCACATCCTG

FROM-TO: 1100 1149
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE GTAATCAGCCGTAAGAGGGCA-GTAGGCA-GGTCTACCTCGGGGTCGTTC
SEQ01 GCGACCTAGGGCTGGCGGGCAGGCGGGCACTGTGTCTCCCTGACTGTGTC
SEQ02 GAAGTGACCAGCTCCCTGGGGGCTAAGCCAGGACGACCCCCAGGGGGGCC

FROM-TO: 1150 1199
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE GTACCCCGCGCCTA-TCCCTTTGATTGTC-C-G-CCCCAC-CTCTCCGCT
SEQ01 CTCCTGTGTCCCTCTGCCTCGCCGCTGTTCCGGAACCTGCTCTGCGCGGC
SEQ02 TCACCCCCTCCACCCTGCCTTCTCACCTGGGCCCCCTCACCTCCTCCCAT

FROM-TO: 1200 1249
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE -CGG-CCCGCA-GGGGACTGCCTGAACAGCGGGGGGGA-TCGCTGCA-GC
SEQ01 ACGTCCTGGCAGTGGGGCAGGTGGAGCTGGGCGGGGGCCCTGGTGCAGGC
SEQ02 GAGGGCAGCTCTGGGGGGTATCTGACGATGTGAGGCCAATCCAGGGGCCG

FROM-TO: 1250 1299
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE CGGGTGGCT-TCG-GGCCGTGATGGGGGGCGCCAAGGAGCGCGGGGGTGG
SEQ01 AGCCTGCAGCCCTTGGCCCTGGAGGGGTCCCTGCAGAAGCGTGGCATTGT
SEQ02 AGGGTCTTGGTGGGCAGCCCTTGGTGGTGATGGGGGGATGCCCATGGGAG

FROM-TO: 1300 1349
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE ACGCCA-CTCTGCAAAGG-GTCCGC-CGTCCTCACGCG-GGGGGACGGGG
SEQ01 GGAACAATGCTGTACCAGCATCTGCTCCCTCTACCAGCTGGAGAACTACT
SEQ02 ATGCCCCGTCACCCAGAGAGAGGGCCCCGTCCCGGGTGGGCTGGCGGGAG

FROM-TO: 1350 1399
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE GAGTAAAGTCGTAGGCGGAAGGGCGCCTGCGCGCCCCCCTCGTGCTAC-C
SEQ01 GCAACTAGACGCAGCCCGCAGGCAGCCCCACACCCGCCGCCTCCTGCACC
SEQ02 CTGGCGGGACGAGGGGGAAAGGGCGCCTGGGCAGGGTCCCACTCCAAGGC

FROM-TO: 1400 1449
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE G-GCGAAA-GGAAGACAGCTTGTCCACCGTC-GCGCCGTCTGGC-CCCT-
SEQ01 GAGAGAGATGGAATAAAGCCCTTGAACCAGC
SEQ02 CGGGCAGGGCGGGCAGGGGGGCGTCCGCTGCCTGACCGTCTCCCCGCAGT

FROM-TO: 1450 1499
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE GGGGGCGCTGGACCCGGCCCC-CCGCC-CCCACGGGCCGCCTGGACGGCC
SEQ01
SEQ02 GGGGGCGCTGGAGCTGGCCGGAGGCCCGGGCGCGGGCGGCCTGGAGGGGC

FROM-TO: 1500 1549
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE CACC-CGG-GGCCTTG--TG-TGGGG-GGTGC-GAGTCAGTGGC-ATGCG
SEQ01
SEQ02 CCCCGCAGAAGCGTGGCATCGTGGAGCAGTGCTGTGCCAGCGTCTGCTCG

FROM-TO: 1550 1599
      5         6         7         8         9
      01234567890123456789012345678901234567890123456789
CONSE C-GTGTTGT-AGACTAAAA-ACCCACCCCT-TTTCCACTC-ACTTCA--C
SEQ01
SEQ02 CTCTACCAGCTGGAGAACTACTGTAACTAGGCCTGCCCCCGACACCAATA

FROM-TO: 1600 1649
      0         1         2         3         4
      01234567890123456789012345678901234567890123456789
CONSE AA-GG-TTC-GACC-------TC----A-G---A-T-----A---T----
SEQ01
SEQ02 AACCCCTTGACGAGCCCTGC

SASA finished. Press any key to continue.
```
